___INFO___

{
  "type": "CLIENT",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Company.info Client",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Client to call the Company.info API and set the returned company data as Event Data and in the browser response\n\nMore information: https://companyinfo.nl/",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "requestPath",
    "displayName": "Request Path",
    "simpleValueType": true,
    "help": "Path of the client that should claim this request",
    "valueHint": "/c-info",
    "notSetText": "Must not be empty",
    "defaultValue": "/c-info"
  },
  {
    "type": "TEXT",
    "name": "allowedTopLevelDomains",
    "displayName": "Allowed Top Level Domains",
    "simpleValueType": true,
    "notSetText": "Must not be empty",
    "valueHint": "domain.com",
    "help": "List of whitelisted top level domains. Use a wildcard * to allow all top level domains. Put each top level domain on a new line",
    "defaultValue": "*",
    "lineCount": 2,
    "textAsList": true
  },
  {
    "type": "TEXT",
    "name": "companyCard",
    "displayName": "Company.info Company Card",
    "simpleValueType": true,
    "notSetText": "Must not be empty",
    "help": "The Company.info Company Card value. This value is to be provided by Company.info"
  },
  {
    "type": "TEXT",
    "name": "contractCard",
    "displayName": "Company.info Contract Card",
    "simpleValueType": true,
    "notSetText": "Must not be empty",
    "help": "The Company.info Contract Card value. This value is to be provided by Company.info"
  },
  {
    "type": "TEXT",
    "name": "responseFields",
    "displayName": "Fields to return to browser (case sensitive)",
    "simpleValueType": true,
    "lineCount": 5,
    "textAsList": true,
    "alwaysInSummary": true,
    "valueHint": "Add each field name on a new line"
  }
]


___SANDBOXED_JS_FOR_SERVER___

// Template By Michel Bieze - https://nl.linkedin.com/in/mbieze - Twitter: @MichelBieze

const JSON = require('JSON');
const Object = require('Object');
const claimRequest = require('claimRequest');
const computeEffectiveTldPlusOne = require('computeEffectiveTldPlusOne');
const encodeUri = require('encodeUri');
const getContainerVersion = require('getContainerVersion');
const getRemoteAddress = require('getRemoteAddress');
const getRequestHeader = require('getRequestHeader');
const getRequestPath = require('getRequestPath');
const getRequestQueryParameter = require('getRequestQueryParameter');
const getType = require('getType');
const returnResponse = require('returnResponse');
const runContainer = require('runContainer');
const setResponseBody = require('setResponseBody');
const setResponseHeader = require('setResponseHeader');
const setResponseStatus = require('setResponseStatus');
const sendHttpGet = require('sendHttpGet');

// Run the Template
init();

// function that validates if this request should be claimed. If so, it runs the template code
function init() {  
  if(!isCompanyInfoRequest() || !isAllowedOrigin()) {
    return;
  }
  
  claimRequest();
  runCompanyInfoClient();
}

// Template Code
function runCompanyInfoClient() {
  sendHttpGet(getRequestUrl(), {
    timeout: 1000,
  }).then((result) => {
    if(result) {
      const companyData = JSON.parse(result.body);
      const eventData = getType(companyData.data[0]) === 'object' ? companyData.data[0] : {};
      const responseBody = getResponseBody(eventData);
      
      runContainer(eventData, returnResponseToBrowser(responseBody, result.statusCode));
    }
  }).catch((error) => {
     runContainer({}, returnResponseToBrowser({error: error.message}, 408));
  });
}

function getResponseBody(eventData) {
  const response = {};
  
  Object.keys(eventData).filter((key) => {
    return data.responseFields.indexOf(key) > -1;
  }).forEach((key) => {
    response[key] = eventData[key];
  });
  
  return JSON.stringify(response);
}

function getRequestUrl() {
  let ipAddress = getRemoteAddress();
  const isPreview = getContainerVersion().previewMode;
  
  if (isPreview && getRequestQueryParameter('test_ip')) {
    ipAddress = getRequestQueryParameter('test_ip');
  }
  
   return 'https://ws2.sizo-solutions.nl/Service/SizoWSEx.ashx?' + 
          'companyCard=' + data.companyCard + '&' +
          'contractCard=' + data.contractCard + '&' +
          'contractParams=ip_adres=' + ipAddress;
}

function returnResponseToBrowser (body, statusCode) {
  if (!body && !statusCode) {
    returnResponse();
  }
  
  if (body) {
    setResponseBody(JSON.stringify(body));
  }
  
  if (statusCode) {
    setResponseStatus(statusCode);
  }
  
  setResponseHeaders();
  returnResponse();
}

function setResponseHeaders() {
    if (!isAllowedOrigin()) {
      return;
    }
  
    if (getRequestHeader('origin')) {
      setResponseHeader('Access-Control-Allow-Origin', getRequestHeader('origin'));
      setResponseHeader('Access-Control-Allow-Credentials', 'true');
    }
  
    setResponseHeader('vary', 'Origin,Accept-Encoding,User-Agent');
    setResponseHeader('Accept-Encoding', 'User-Agent');
    setResponseHeader('content-type', 'text/plain; charset=utf-8'); 
    setResponseHeader('Cache-Control', 'no-store');
    setResponseHeader('Strict-Transport-Security', 'max-age=31536000');
}

function getAllowedOrigins() {
  if (getType(data.allowedTopLevelDomains) === 'string') {
    return [data.allowedTopLevelDomains];
  }
  
  if (getType(data.allowedTopLevelDomains) === 'array') {
    return data.allowedTopLevelDomains;
  }
  
  return [];
}

/* helper to validate if the request comes from an allowed domain */
function isAllowedOrigin() {
  const allowedOrigins = data.allowedTopLevelDomains || [];
  
  if (allowedOrigins[0] === '*') {
    // always allow the request
    return true;
  }
  
  if (getRequestHeader('origin')) {
    // the origin header is present in the request 
    const requestOriginTld = computeEffectiveTldPlusOne(getRequestHeader('origin'));
    return allowedOrigins.some((allowedOriginTld) => {
      return allowedOriginTld === requestOriginTld;
    });
  }
 
  // fallback. The request header is not present in the request, nut not all requests are allowed
  return false;
}

/* helper to validate if this client should claim the request */
function isCompanyInfoRequest() {
  return data.requestPath.toLowerCase() === getRequestPath().toLowerCase();
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ws2.sizo-solutions.nl/Service/SizoWSEx.ashx*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "Forwarded"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "X-Forwarded-For"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "origin"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "queryParametersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "remoteAddressAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "pathAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "queryParameter"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "test_ip"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "return_response",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_response",
        "versionId": "1"
      },
      "param": [
        {
          "key": "writeResponseAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "writeHeaderAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "run_container",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 5/13/2023, 10:34:40 AM


